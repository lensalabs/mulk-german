---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Mulk 30">
  <div class="min-h-screen flex flex-col items-center justify-center px-6 py-12 bg-[var(--color-background)]">
    <div class="w-full max-w-sm text-center">
      
      <!-- Logo -->
      <img src="/logo-stacked.svg" alt="Mulk 30" class="w-48 mx-auto mb-8" />
      
      <!-- Tagline -->
      <p class="text-[var(--color-text-secondary)] mb-10">Mëso Suren Mulk për 30 ditë</p>
      
      <!-- Login Options -->
      <div class="space-y-3">
        <!-- Email Login -->
        <a href="/auth/email" class="w-full flex items-center justify-center gap-3 py-4 px-6 bg-[var(--color-primary)] text-white rounded-xl font-medium hover:opacity-90 active:scale-[0.98] transition-all">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
          </svg>
          Vazhdo me Email
        </a>
        
        <!-- Divider -->
        <div class="flex items-center gap-3 my-2">
          <div class="flex-1 h-px bg-[var(--color-border)]"></div>
          <span class="text-xs text-[var(--color-text-secondary)]">ose</span>
          <div class="flex-1 h-px bg-[var(--color-border)]"></div>
        </div>
        
        <!-- Guest Mode -->
        <button id="guest-btn" class="w-full flex flex-col items-center justify-center gap-1 py-4 px-6 bg-[var(--color-primary)]/10 border border-[var(--color-primary)]/30 rounded-xl hover:bg-[var(--color-primary)]/20 active:scale-[0.98] transition-all">
          <span class="flex items-center gap-2 font-medium text-[var(--color-primary)]">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
            </svg>
            Vazhdo si Vizitor
          </span>
          <span class="text-xs text-[var(--color-text-secondary)]">Progresi nuk ruhet</span>
        </button>
      </div>
      
      <!-- Motivation Audio -->
      <div class="mt-10 p-4 bg-[var(--color-surface)] rounded-2xl border border-[var(--color-border)]">
        <p class="text-xs text-[var(--color-text-secondary)] mb-3">Mesazh i shkurtër nga hoxhë Enis Rama</p>
        <div class="flex items-center gap-3">
          <button id="motivation-play" class="w-12 h-12 shrink-0 rounded-full bg-[var(--color-primary)] flex items-center justify-center text-white active:scale-95 transition-transform">
            <svg id="motivation-play-icon" class="w-5 h-5 ml-0.5" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
            <svg id="motivation-pause-icon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
          </button>
          <div class="flex-1 min-w-0">
            <p class="text-sm font-medium text-[var(--color-text)] truncate">Vlera e mësimit të sures Mulk</p>
            <div class="flex items-center gap-2 mt-1">
              <div class="flex-1 h-1.5 bg-[var(--color-border)] rounded-full overflow-hidden">
                <div id="motivation-progress" class="h-full bg-[var(--color-primary)] rounded-full transition-all duration-100" style="width: 0%"></div>
              </div>
              <span id="motivation-time" class="text-xs text-[var(--color-text-secondary)] tabular-nums">0:00</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Footer -->
      <p class="mt-6 text-xs text-[var(--color-text-secondary)]">
        Nga Përkujtuesi Ditor
      </p>
      
    </div>
  </div>
</Layout>

<script>
  import { signInAsGuest, getSession } from '../lib/supabase';
  
  // Check if already logged in
  (async () => {
    const { session } = await getSession();
    if (session) {
      window.location.href = '/app';
    }
  })();
  
  document.getElementById('guest-btn')?.addEventListener('click', async () => {
    await signInAsGuest();
  });
  
  // Motivation audio player
  const motivationAudio = new Audio('/Hoxhe-Enis-Rama.mp3');
  const playBtn = document.getElementById('motivation-play');
  const playIcon = document.getElementById('motivation-play-icon');
  const pauseIcon = document.getElementById('motivation-pause-icon');
  const progressBar = document.getElementById('motivation-progress');
  const timeDisplay = document.getElementById('motivation-time');
  let isPlaying = false;
  
  function formatTime(seconds: number): string {
    const mins = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return `${mins}:${secs.toString().padStart(2, '0')}`;
  }
  
  playBtn?.addEventListener('click', () => {
    if (isPlaying) {
      motivationAudio.pause();
      playIcon?.classList.remove('hidden');
      pauseIcon?.classList.add('hidden');
    } else {
      motivationAudio.play();
      playIcon?.classList.add('hidden');
      pauseIcon?.classList.remove('hidden');
    }
    isPlaying = !isPlaying;
  });
  
  motivationAudio.addEventListener('timeupdate', () => {
    if (progressBar && motivationAudio.duration) {
      const percent = (motivationAudio.currentTime / motivationAudio.duration) * 100;
      progressBar.style.width = `${percent}%`;
    }
    if (timeDisplay) {
      timeDisplay.textContent = formatTime(motivationAudio.currentTime);
    }
  });
  
  motivationAudio.addEventListener('ended', () => {
    isPlaying = false;
    playIcon?.classList.remove('hidden');
    pauseIcon?.classList.add('hidden');
    if (progressBar) progressBar.style.width = '0%';
    if (timeDisplay) timeDisplay.textContent = '0:00';
  });
</script>
